<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

    <div class="container mt-4">
        <h2 class="mb-3" th:text="${event.title}"></h2>

        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>User</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Mark</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="reg : ${registrations}">
                    <td th:text="${reg.user.name}"></td>
                    <td th:text="${reg.user.email}"></td>

                    <td>
                        <span th:if="${reg.attendance != null}" class="badge bg-success">Arrived</span>
                        <span th:if="${reg.attendance == null}" class="badge bg-secondary">Not Arrived</span>
                    </td>

                    <td>
                        <div th:if="${reg.attendance == null}">
                            <a th:href="@{/api/attendance/mark/{regId}(regId=${reg.id})}"
                                class="btn btn-sm btn-success mark-arrived-btn">
                                Mark Arrived
                            </a>
                            <a th:href="@{/api/registrations/delete/{id}(id=${reg.id})}"
                                class="btn btn-danger btn-sm"
                                onclick="return confirm('Are you sure you want to delete this attendance?');">
                                Delete
                            </a>
                        </div>

                        <span th:if="${reg.attendance != null}" class="text-success fw-bold">âœ” Marked</span>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="text-center mt-4">
            <a href="javascript:history.back()" class="btn btn-primary">Go Back</a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            document.querySelectorAll(".mark-arrived-btn").forEach(btn => {

                btn.addEventListener("click", function (event) {
                    event.preventDefault();  // stop direct navigation

                    let url = this.getAttribute("href");

                    if (confirm("Are you sure you want to mark this user as Arrived?")) {
                        window.location.href = url; // proceed if confirmed
                    }
                });

            });

        });
    </script>


</body>

</html>